# react中 diff dom 算法


##  常用的diff算法问题的复杂度

1. 遍历原始数的复杂程度是n.
2. 如果将改变后的数遍历，病判断这个节点对应原来节点的位置，所以每个节点都需要把原来的树再遍历一遍，这样得到的结果是n * n.
3. 涉及到编辑距离，通俗地来讲，编辑距离指的是在两个单词<w_1,w_2>之间，由其中一个单词w_1转换为另一个单词w_2所需要的最少单字符编辑操作次数。这里的操作动作包括（插入、删除、替换）所以diff的复杂度是 n * n * n;

## 针对react来说，其实并不需要做这么多的遍历。

###原始的diff策略并不适用于react中，所以react提出了以下几个策略。

1. web ui 中dom节点夸层级的移动操作并不少，可以忽略不记。
2. 拥有相同类的组件将会生成相似的树形结构，拥有不同类的组件将会生成不同的树形结构。
3. 对于同一层级的一组节点，他们可以通过唯一的id进行区分。


### 针对上面的策略react提出了在三个方面进行dom

1. tree diff
2. component diff
3. element diff

### diff tree

基于策略一对算法进行优化，两棵树只会对用一级的节点进行比较，如果节点中出现移动节点的操作，react也会进行删除原来的节点，创建新的节点。注意组件A会重新实例。

### component Diff

因为react 是基于组件构建应用，所以再diff的时候可以直接对比组件

主要集中再三个方面

+ 如果是同一类型的组件，按照原策略进行对比虚拟dom
+ 如果不是，则将改组件判断为dirty component 组件，替换组件下的所有子节点
+ 对同一类型的组件，有可能virtual dom没有发生任何变化，如果知道这些点可以节省大量的时间，所以加入了shoudCompoentUpdate函数。

### element diff

对于同一层级的组件react提供了三种操作方式，分别是插入、移动、删除。

+ 记住最主要一点就是map数组生成组件是加上key，key不能是索引。
