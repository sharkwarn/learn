

## dns解析

dns的作用非常简单就是根据域名查询IP地址。

首先在浏览器访问一个网址的时候，浏览器先查询本机host文件有没有对应的IP
没有的话依次查询

路由器-->ISP(服务商)-->根域名服务器

根域名服务器服务器又是一个复杂的过程。

DNS服务器根据域名的层级，进行分级查询。

例如：www.baidu.com

这是一个普通的域名，但是这个域名省略了一个“.“

该域名的完整路径应该是

wwww.baidu.com.

该“.“表示的就是根域名，因为所有的根域名都是一样的。所以可以省略。

根域名的下一级“.com”叫做<b>顶级域名</b>（top-level domain，缩写TLD）

在下一级叫做<b>次级域名</b>(second-level domain)。例如.baidu

再下一级叫做<b>主机名</b>（host），又被称做三级域名。

<div style="background: #fafafa; border-radius: 5px;">

1. 从"根域名服务器"查到"顶级域名服务器"的NS记录和A记录（IP地址）

2. 从"顶级域名服务器"查到"次级域名服务器"的NS记录和A记录（IP地址）

3. 从"次级域名服务器"查出"主机名"的IP地址

</div>

根域名服务器的地址一般是不会变的，所以内置在dns服务器里面。


世界上一共有十三组根域名服务器，从A.ROOT-SERVERS.NET一直到M.ROOT-SERVERS.NET。当然现在不止这些数字。

根据内置的根域名服务器IP地址，DNS服务器向所有这些IP地址发出查询请求，询问www.baidu.com的顶级域名服务器com.的NS记录。最先回复的根域名服务器将被缓存，以后只向这台服务器发请求。

按照同样的方式查询次级域名和主机名。


## cdn

dns在解析的时候，域名与IP之间的对应关系，称为"记录"（record）。根据使用场景，"记录"可以分成不同的类型（type）

（1） A：地址记录（Address），返回域名指向的IP地址。

（2） NS：域名服务器记录（Name Server），返回保存下一级域名信息的服务器地址。该记录只能设置为域名，不能设置为IP地址。

（3）MX：邮件记录（Mail eXchange），返回接收电子邮件的服务器地址。

（4）CNAME：规范名称记录（Canonical Name），返回另一个域名，即当前查询的域名是另一个域名的跳转，详见下文。

（5）PTR：逆向查询记录（Pointer Record），只用于从IP地址查询域名，详见下文。


如果配置了cdn服务，便会有CNAME（别名），CNAME的记录会有一个A记录，指向的被转化后的IP地址。该地址就是<b>全局负载均衡系统</b>（GSLB）。

GSLB的主要作用是根据用户的的本地dns筛选出最近的 <b>本地负载均衡系统（SLB）</b> 并将SLB的ip地址返回给本地的dns。

SLB主要负责判断缓存服务器集群中是否包含用户请求的资源数据，如果缓存服务器中存在请求的资源，则根据缓存服务器集群中节点的健康程度、负载量、连接数等因素筛选出最优的缓存节点，并将HTTP请求重定向到最优的缓存节点上。

然后客户端开始请求缓存服务器


参考：

[http://www.ruanyifeng.com/blog/2016/06/dns.html](http://www.ruanyifeng.com/blog/2016/06/dns.html)
[https://juejin.im/post/5d105e1af265da1b71530095](https://juejin.im/post/5d105e1af265da1b71530095)